#!/bin/bash

tag="1.8"

if ! grep -q "# ConcuBinE" README.md 2> /dev/null
then
  echo "error: please execute me in the base directory" >&2
  exit 1
fi

function cleanup {
  rm -rf $tmp
}
trap cleanup EXIT

tmp=$(mktemp -d --tmpdir "concubine-XXXX")
cwd=$(pwd)
cd $tmp

git clone --depth 1 --branch $tag https://github.com/CVC4/CVC4.git

cd CVC4

./contrib/get-antlr-3.4
./contrib/get-kissat

# check if the static libgmp is available else error: cannot find -lgmp
ldconfig -p | grep -q "libgmp\.a" || ./contrib/get-gmp-dev

./configure.sh production --static --kissat

cd build

make || exit 1

cp bin/cvc4 $cwd/bin
cp ../COPYING $cwd/bin/licenses/cvc4
